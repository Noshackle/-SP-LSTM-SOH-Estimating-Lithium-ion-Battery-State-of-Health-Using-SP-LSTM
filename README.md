# 基于双电极单粒子模型与LSTM的锂离子电池SOH估计方法

## 目录

1. [项目概述](#1-项目概述)
2. [理论背景](#2-理论背景)
3. [方法论](#3-方法论)
   - [3.1 双电极单粒子模型 (Dual Electrode SPM)](#31-双电极单粒子模型-dual-electrode-spm)
   - [3.2 参数辨识方法 (PSO-LBFGS混合优化)](#32-参数辨识方法-pso-lbfgs混合优化)
   - [3.3 特征工程](#33-特征工程)
   - [3.4 SP-LSTM网络架构](#34-sp-lstm网络架构)
4. [实验设置](#4-实验设置)
5. [结果分析](#5-结果分析)
6. [文件结构](#6-文件结构)
7. [使用方法](#7-使用方法)

---

## 1. 项目概述

本项目提出了一种**融合电化学机理模型与数据驱动方法**的锂离子电池健康状态（State of Health, SOH）估计框架。该方法的核心创新在于：

- 建立**双电极单粒子模型 (Dual Electrode Single Particle Model, SPM)**，刻画正负极的电化学动力学过程
- 采用**PSO-LBFGS混合优化算法**进行模型参数辨识，兼顾全局搜索能力与局部收敛精度
- 提取**外部可测特征**与**SPM内部微观状态特征**的融合特征向量
- 设计**SP-LSTM神经网络**，利用时序特征预测电池SOH

数据集采用 **NASA Battery Dataset** 中的 B0005、B0006、B0007（训练集）和 B0018（测试集）四块18650锂离子电池的充放电循环数据。

---

## 2. 理论背景

### 2.1 电池健康状态 (SOH)

电池健康状态定义为当前电池容量与首次实测容量的比值：

$$
\text{SOH}_k = \frac{Q_k}{Q_{\text{initial}}} \times 100\%
$$

其中：

- $Q_k$：第 $k$ 次循环的实际放电容量 [Ah]
- $Q_{\text{initial}}$：该电池首次循环（$k=0$）的实测放电容量 [Ah]

**$Q_k$ 的计算方法**（代码实现）：

对于每个放电循环，通过电流-时间积分计算容量：

$$
Q_k = \int_{t_0}^{t_{\text{end}}} |I(t)| \, dt = \frac{1}{3600}\sum_{j=1}^{N} (-I_j) \cdot \Delta t_j \quad \text{[Ah]}
$$

对应代码（`data_loader.py`）：

```python
def _compute_capacity(self, t, I):
    dt = np.diff(t, prepend=t[0])
    Q = np.sum(-I * dt) / 3600.0  # [Ah]，放电电流为负
    return Q

def get_soh(self, battery_id, cycle_idx):
    Q_k = self._compute_capacity(t, I)
    Q_initial = self.get_initial_capacity(battery_id)  # 首次循环容量
    SOH = Q_k / Q_initial
    return SOH
```

> **说明**：采用 $Q_{\text{initial}}$（首次实测容量）作为基准，而非固定的标称容量2.0 Ah，可消除电池个体差异。这样每块电池在循环0时 SOH = 100%。

### 2.2 锂离子电池工作原理

锂离子电池在充放电过程中，锂离子在正负极之间脱嵌和嵌入。放电时：

- **负极（石墨）**：$\text{Li}_x\text{C}_6 \rightarrow \text{C}_6 + x\text{Li}^+ + xe^-$
- **正极（钴酸锂LCO）**：$\text{Li}_{1-x}\text{CoO}_2 + x\text{Li}^+ + xe^- \rightarrow \text{LiCoO}_2$

---

## 3. 方法论

### 3.1 双电极单粒子模型 (Dual Electrode SPM)

单粒子模型将电极简化为**等效球形颗粒**，假设电极内所有活性材料颗粒具有相同的行为。本项目采用双电极SPM，分别对正极和负极建模。

#### 3.1.1 电极几何参数

本模型涉及的电极几何参数分为**已知参数**（固定值）和**待辨识参数**（优化求解）两类：

**已知几何参数（固定值）：**

| 符号                  | 含义                         | 值                    | 单位 | 状态           | 来源                    |
| --------------------- | ---------------------------- | --------------------- | ---- | -------------- | ----------------------- |
| $L_p$               | 正极涂层厚度                 | $70 \times 10^{-6}$ | m    | **已知** | 18650电池典型值 [1]     |
| $L_n$               | 负极涂层厚度                 | $80 \times 10^{-6}$ | m    | **已知** | 18650电池典型值 [1]     |
| $\varepsilon_{s,p}$ | 正极活性物质体积分数         | 0.5                   | -    | **已知** | 电极设计典型值 [1]      |
| $\varepsilon_{s,n}$ | 负极活性物质体积分数         | 0.6                   | -    | **已知** | 电极设计典型值 [1]      |
| $A_{\text{geo}}$    | 电极几何面积（卷绕展开面积） | 0.042                 | m²  | **已知** | 根据2.0Ah 18650电池计算 |

> **说明**：
>
> - $L_p$：正极活性材料涂层在集流体（铝箔）上的厚度
> - $L_n$：负极活性材料涂层在集流体（铜箔）上的厚度
> - $\varepsilon_{s,i}$：电极体积中活性材料颗粒所占的比例（其余为孔隙和粘结剂）
> - $A_{\text{geo}}$：电极片展开后的有效面积，根据18650圆柱电池卷绕结构计算得到（详见下文）

**$A_{\text{geo}}$ 的计算方法（18650圆柱电池卷绕结构）**：

18650电池采用卷绕结构，电极片被卷成螺旋状装入圆柱形外壳。电极几何面积 $A_{\text{geo}}$ 可通过以下方法计算：

**方法1：基于电池容量反推**

根据电池标称容量和材料理论比容量反推：

$$
A_{\text{geo}} = \frac{Q_{\text{nominal}} \cdot 3600}{C_{\text{theo}} \cdot L_{\text{electrode}} \cdot \varepsilon_s \cdot \rho_s}
$$

| 符号                     | 含义               | 典型值                 | 单位   |
| ------------------------ | ------------------ | ---------------------- | ------ |
| $Q_{\text{nominal}}$   | 电池标称容量       | 2.0                    | Ah     |
| $C_{\text{theo}}$      | 活性材料理论比容量 | 140 (LCO) / 372 (石墨) | mAh/g  |
| $L_{\text{electrode}}$ | 电极涂层厚度       | 70~80                  | μm    |
| $\varepsilon_s$        | 活性物质体积分数   | 0.5~0.6                | -      |
| $\rho_s$               | 活性材料密度       | 5.0 (LCO) / 2.2 (石墨) | g/cm³ |

**方法2：基于卷绕几何结构计算**

18650电池外壳内径约为 $D_{\text{inner}} \approx 17$ mm，电极片卷绕后形成螺旋结构：

$$
A_{\text{geo}} = W \cdot L_{\text{total}}
$$

其中：

- $W$：电极片宽度（对应电池高度方向），约 $W \approx 58$ mm（考虑顶部和底部预留空间）
- $L_{\text{total}}$：电极片展开长度

电极片展开长度可通过螺旋卷绕公式估算：

$$
L_{\text{total}} = \sum_{k=1}^{n} 2\pi r_k = \sum_{k=1}^{n} 2\pi (r_{\text{core}} + k \cdot d_{\text{layer}})
$$

简化为连续积分形式：

$$
L_{\text{total}} \approx \frac{\pi (r_{\text{outer}}^2 - r_{\text{core}}^2)}{d_{\text{layer}}}
$$

| 符号                 | 含义                            | 典型值 | 单位 |
| -------------------- | ------------------------------- | ------ | ---- |
| $r_{\text{core}}$  | 卷芯半径（中心空心区）          | 2.0    | mm   |
| $r_{\text{outer}}$ | 外圈半径                        | 8.5    | mm   |
| $d_{\text{layer}}$ | 单层厚度（正极+隔膜+负极+隔膜） | ~0.3   | mm   |
| $n$                | 卷绕圈数                        | ~20    | -    |

**数值估算**：

$$
L_{\text{total}} \approx \frac{\pi \times (8.5^2 - 2^2)}{0.3} \approx \frac{\pi \times 68.25}{0.3} \approx 715 \text{ mm} \approx 0.715 \text{ m}
$$

$$
A_{\text{geo}} = W \times L_{\text{total}} = 0.058 \times 0.715 \approx 0.041 \text{ m}^2 \approx 0.042 \text{ m}^2
$$

> **验证**：计算结果 $A_{\text{geo}} \approx 0.042$ m² 与代码中设定值一致，符合2.0Ah 18650电池的典型参数。

**待辨识几何参数：**

| 符号    | 含义         | 辨识范围                                     | 单位 | 状态             |
| ------- | ------------ | -------------------------------------------- | ---- | ---------------- |
| $R_p$ | 正极颗粒半径 | $1 \times 10^{-6}$ ~ $20 \times 10^{-6}$ | m    | **待辨识** |
| $R_n$ | 负极颗粒半径 | $1 \times 10^{-6}$ ~ $20 \times 10^{-6}$ | m    | **待辨识** |

> **说明**：
>
> - $R_p$、$R_n$：等效球形颗粒的半径，是SPM的核心假设，将电极简化为单一颗粒

**比表面积计算**：

根据球形颗粒假设，比表面积（单位体积电极的活性表面积）计算公式为：

$$
a_{s,i} = \frac{3\varepsilon_{s,i}}{R_i}, \quad i \in \{p, n\}
$$

其中：

- $a_{s,i}$：比表面积 [m⁻¹]（**计算量**，由已知参数和辨识参数导出）
- 数字 3 来自球体表面积与体积的关系：$\frac{4\pi R^2}{\frac{4}{3}\pi R^3} = \frac{3}{R}$

**总活性面积**：

$$
A_{\text{total},i} = A_{\text{geo}} \cdot L_i \cdot a_{s,i}
$$

- $A_{\text{total},i}$：电极总活性表面积 [m²]（**计算量**）
- 物理意义：用于计算电极表面的离子通量与电流的关系

#### 3.1.2 固相扩散方程

锂离子在球形颗粒内部的扩散遵循 Fick 第二定律（球坐标系）：

$$
\frac{\partial c_{s,i}}{\partial t} = \frac{D_i}{r^2} \frac{\partial}{\partial r}\left(r^2 \frac{\partial c_{s,i}}{\partial r}\right)
$$

**变量说明**：

| 符号        | 含义           | 单位    | 状态               | 说明                                     |
| ----------- | -------------- | ------- | ------------------ | ---------------------------------------- |
| $c_{s,i}$ | 固相锂离子浓度 | mol/m³ | **状态变量** | 随时间和空间变化，通过求解扩散方程得到   |
| $t$       | 时间           | s       | **自变量**   | 由实验数据提供                           |
| $r$       | 颗粒径向坐标   | m       | **自变量**   | 从颗粒中心（$r=0$）到表面（$r=R_i$） |
| $D_i$     | 固相扩散系数   | m²/s   | **待辨识**   | 描述锂离子在固相材料中的传输能力         |

> **说明**：下标 $i \in \{p, n\}$ 分别表示正极（positive）和负极（negative）

**边界条件**：

| 位置                 | 数学表达式                                                               | 物理意义                             |
| -------------------- | ------------------------------------------------------------------------ | ------------------------------------ |
| 颗粒中心 ($r=0$)   | $\left.\frac{\partial c_{s,i}}{\partial r}\right\|_{r=0} = 0$          | 球心对称条件，无浓度梯度             |
| 颗粒表面 ($r=R_i$) | $-D_i \left.\frac{\partial c_{s,i}}{\partial r}\right\|_{r=R_i} = j_i$ | 表面通量等于电化学反应产生的离子通量 |

其中 $j_i$ 为电极表面摩尔通量 [mol/(m²·s)]，由外电路电流决定（**计算量**）。

**简化近似**（多项式近似）：

为避免求解偏微分方程的计算开销，采用低频近似公式计算表面浓度：

$$
c_{s,\text{surf},i} = \bar{c}_{s,i} - \frac{R_i}{5D_i} j_i
$$

| 符号                    | 含义               | 状态               | 说明                          |
| ----------------------- | ------------------ | ------------------ | ----------------------------- |
| $c_{s,\text{surf},i}$ | 颗粒表面锂离子浓度 | **计算量**   | 用于计算OCV和过电位           |
| $\bar{c}_{s,i}$       | 颗粒体积平均浓度   | **状态变量** | 通过质量守恒方程更新          |
| $\frac{R_i}{5D_i}$    | 扩散时间常数的倒数 | **计算量**   | 系数5来自多项式近似的数学推导 |

**系数5的数学推导**：

多项式近似方法基于假设浓度分布可以用径向坐标的多项式展开。推导过程如下：

**Step 1：设定多项式形式**

假设球形颗粒内部的浓度分布为二次多项式形式：

$$
c_s(r,t) = a_0(t) + a_2(t) r^2
$$

> 由于球心对称性，奇次项系数为零（$a_1 = 0$），满足中心边界条件 $\frac{\partial c_s}{\partial r}\big|_{r=0} = 0$

**Step 2：计算体积平均浓度**

球形颗粒的体积平均浓度定义为：

$$
\bar{c}_s = \frac{3}{R^3} \int_0^R c_s(r) r^2 dr
$$

将多项式代入：

$$
\bar{c}_s = \frac{3}{R^3} \int_0^R (a_0 + a_2 r^2) r^2 dr = \frac{3}{R^3} \left[ a_0 \frac{r^3}{3} + a_2 \frac{r^5}{5} \right]_0^R
$$

$$
\bar{c}_s = \frac{3}{R^3} \left( a_0 \frac{R^3}{3} + a_2 \frac{R^5}{5} \right) = a_0 + \frac{3}{5} a_2 R^2
$$

**Step 3：计算表面浓度**

表面浓度为 $r = R$ 处的值：

$$
c_{s,\text{surf}} = c_s(R) = a_0 + a_2 R^2
$$

**Step 4：应用表面边界条件**

表面通量边界条件：

$$
-D \frac{\partial c_s}{\partial r}\bigg|_{r=R} = j
$$

对多项式求导：

$$
\frac{\partial c_s}{\partial r} = 2 a_2 r
$$

在 $r = R$ 处：

$$
-D \cdot 2 a_2 R = j \quad \Rightarrow \quad a_2 = -\frac{j}{2DR}
$$

**Step 5：消去 $a_0$，建立表面浓度与平均浓度的关系**

从 Step 2 的结果：

$$
a_0 = \bar{c}_s - \frac{3}{5} a_2 R^2
$$

代入 Step 3 的表面浓度表达式：

$$
c_{s,\text{surf}} = a_0 + a_2 R^2 = \left( \bar{c}_s - \frac{3}{5} a_2 R^2 \right) + a_2 R^2
$$

$$
c_{s,\text{surf}} = \bar{c}_s + \frac{2}{5} a_2 R^2
$$

**Step 6：代入 $a_2$ 的表达式**

将 Step 4 得到的 $a_2 = -\frac{j}{2DR}$ 代入：

$$
c_{s,\text{surf}} = \bar{c}_s + \frac{2}{5} \left( -\frac{j}{2DR} \right) R^2
$$

$$
c_{s,\text{surf}} = \bar{c}_s - \frac{2}{5} \cdot \frac{j R^2}{2DR}
$$

$$
c_{s,\text{surf}} = \bar{c}_s - \frac{R}{5D} j
$$

$$
\boxed{c_{s,\text{surf}} = \bar{c}_s - \frac{R}{5D} j}
$$

> **结论**：系数 **5** 来自球形颗粒内二次多项式浓度分布假设下的体积平均积分，是 $\frac{3}{5}$ 和 $\frac{2}{5}$ 分数运算的结果。这一近似在低频（准稳态）条件下有效，避免了求解完整的扩散偏微分方程。

**质量守恒方程**（平均浓度更新）：

$$
\frac{d\bar{c}_{s,i}}{dt} = -\frac{3j_i}{R_i}
$$

- 系数3来自球形颗粒的表面积/体积比：$\frac{3}{R}$

#### 3.1.3 电极反应动力学 (Butler-Volmer 方程)

电极表面的嵌锂/脱锂反应遵循Butler-Volmer方程，描述电化学反应速率与过电位的关系：

$$
j_i = j_{0,i} \left[\exp\left(\frac{\alpha_a F \eta_i}{RT}\right) - \exp\left(-\frac{\alpha_c F \eta_i}{RT}\right)\right]
$$

**物理常数（已知，固定值）**：

| 符号         | 含义         | 值       | 单位       | 来源                  |
| ------------ | ------------ | -------- | ---------- | --------------------- |
| $F$        | 法拉第常数   | 96485.33 | C/mol      | 物理常数 [4]          |
| $R$        | 通用气体常数 | 8.314    | J/(mol·K) | 物理常数 [4]          |
| $T$        | 绝对温度     | 298.15   | K          | 实验条件（25°C室温） |
| $\alpha_a$ | 阳极传递系数 | 0.5      | -          | 对称反应假设 [1]      |
| $\alpha_c$ | 阴极传递系数 | 0.5      | -          | 对称反应假设 [1]      |

> **说明**：
>
> - $\alpha_a + \alpha_c = 1$（电荷守恒）
> - 对于对称反应，取 $\alpha_a = \alpha_c = 0.5$，这是锂离子电池电极反应的常用假设

**对称反应简化形式**：

当 $\alpha_a = \alpha_c = 0.5$ 时，Butler-Volmer方程简化为：

$$
j_i = 2j_{0,i} \sinh\left(\frac{F\eta_i}{2RT}\right)
$$

**反解过电位**：

$$
\eta_i = \frac{2RT}{F} \text{arcsinh}\left(\frac{j_i}{2j_{0,i}}\right)
$$

| 符号        | 含义             | 单位         | 状态             | 说明                 |
| ----------- | ---------------- | ------------ | ---------------- | -------------------- |
| $\eta_i$  | 电极过电位       | V            | **计算量** | 偏离平衡电位的程度   |
| $j_i$     | 电极表面摩尔通量 | mol/(m²·s) | **计算量** | 由电流$I$ 计算得到 |
| $j_{0,i}$ | 交换电流密度     | mol/(m²·s) | **计算量** | 表征反应可逆性       |

**通量计算**：

$$
j_n = -\frac{I}{A_{\text{total},n} \cdot F}, \quad j_p = \frac{I}{A_{\text{total},p} \cdot F}
$$

> **符号约定**：$I < 0$ 表示放电（电流流出），$I > 0$ 表示充电

**交换电流密度**：

$$
j_{0,i} = k_i \sqrt{c_e \cdot c_{s,\text{surf},i} \cdot (c_{s,\max,i} - c_{s,\text{surf},i})}
$$

| 符号                    | 含义             | 值/范围                    | 单位                    | 状态                   | 来源               |
| ----------------------- | ---------------- | -------------------------- | ----------------------- | ---------------------- | ------------------ |
| $k_i$                 | 反应速率常数     | $10^{-13}$ ~ $10^{-9}$ | (mol/m³)^{-0.5}·(m/s) | **待辨识**       | 优化求解           |
| $c_e$                 | 电解液锂离子浓度 | 1000                       | mol/m³                 | **已知（固定）** | 典型电解液浓度 [1] |
| $c_{s,\text{surf},i}$ | 表面锂离子浓度   | -                          | mol/m³                 | **计算量**       | 由扩散方程得到     |
| $c_{s,\max,i}$        | 最大锂离子浓度   | 见下表                     | mol/m³                 | **待辨识**       | 优化求解           |

**待辨识动力学参数**：

| 参数             | 符号             | 辨识范围                   | 单位    | 物理意义                    |
| ---------------- | ---------------- | -------------------------- | ------- | --------------------------- |
| 正极反应速率常数 | $k_p$          | $10^{-13}$ ~ $10^{-9}$ | -       | 正极Li⁺嵌入/脱出的反应活性 |
| 负极反应速率常数 | $k_n$          | $10^{-13}$ ~ $10^{-9}$ | -       | 负极Li⁺嵌入/脱出的反应活性 |
| 正极最大浓度     | $c_{s,\max,p}$ | 30000 ~ 60000              | mol/m³ | 正极材料完全嵌锂时的浓度    |
| 负极最大浓度     | $c_{s,\max,n}$ | 20000 ~ 50000              | mol/m³ | 负极材料完全嵌锂时的浓度    |

#### 3.1.4 开路电压 (OCV) 函数

开路电压（Open Circuit Voltage, OCV）是指电池在无电流通过时的端电压，仅取决于电极的嵌锂状态。

**化学计量比定义（核心公式）**：

在仿真过程中，化学计量比 $\theta$ 直接由表面浓度定义：

$$
\theta_i = \frac{c_{s,\text{surf},i}}{c_{s,\max,i}}
$$

| 符号                    | 含义                 | 范围  | 状态             | 说明                           |
| ----------------------- | -------------------- | ----- | ---------------- | ------------------------------ |
| $\theta_i$            | 化学计量比（嵌锂度） | 0 ~ 1 | **计算量** | 表示电极材料被锂离子填充的程度 |
| $c_{s,\text{surf},i}$ | 表面锂离子浓度       | -     | **计算量** | 由扩散方程求解得到             |
| $c_{s,\max,i}$        | 最大锂离子浓度       | -     | **待辨识** | 电极材料的理论容量             |

> **重要说明**：仿真过程中 $\theta$ 的计算**仅使用上述定义式**，不涉及SOC的逆向计算。

**计算流程**：

```
电流 I → 通量 j → 扩散方程求 c_surf → 定义式算 θ → OCV函数算 U → 端电压 V_cell
```

即：给定电流后，通过扩散方程正向求解浓度，再用定义式计算 $\theta$，最后代入OCV函数。

**SOC与化学计量比的对应关系（仅用于初始化）**：

以下映射关系**仅用于设定仿真初始条件**，不参与仿真过程中的计算：

| SOC            | $\theta_n$（负极） | $\theta_p$（正极） | 说明               |
| -------------- | -------------------- | -------------------- | ------------------ |
| 100%（满充）   | 0.85                 | 0.40                 | 负极富锂，正极贫锂 |
| 0%（完全放电） | 0.01                 | 0.99                 | 负极贫锂，正极富锂 |

**初始化用途**：

当仿真开始时，需要设定初始平均浓度 $\bar{c}_{s,0}$：

1. 已知初始SOC（如100%满充或根据初始电压估算）
2. 通过映射关系计算初始化学计量比 $\theta_{\text{init}}$
3. 设定初始浓度：$\bar{c}_{s,0} = \theta_{\text{init}} \times c_{s,\max}$

$$
\theta_{n,\text{init}} = 0.01 + 0.84 \times \text{SOC}_0
$$

$$
\theta_{p,\text{init}} = 0.99 - 0.59 \times \text{SOC}_0
$$

> **注意**：初始化完成后，仿真过程中 $\theta$ 完全由扩散方程和定义式决定，不再使用上述映射公式。

**参数来源与文献依据**：

上述化学计量比边界值来自以下文献：

| 参数                 | 值   | 来源文献                      | 说明                                                             |
| -------------------- | ---- | ----------------------------- | ---------------------------------------------------------------- |
| $\theta_{n,100\%}$ | 0.85 | Ramadass et al. (2004) [8]    | 石墨负极在满充状态下的嵌锂度上限，略低于理论值1.0以避免析锂      |
| $\theta_{n,0\%}$   | 0.01 | Safari & Delacourt (2011) [5] | 石墨负极在完全放电状态的残余嵌锂度，避免完全脱锂                 |
| $\theta_{p,100\%}$ | 0.40 | Doyle et al. (1996) [9]       | LCO正极在满充状态下的脱锂度下限，$\text{Li}_{0.4}\text{CoO}_2$ |
| $\theta_{p,0\%}$   | 0.99 | Ning & Popov (2004) [10]      | LCO正极在放电终止时的嵌锂度上限，接近$\text{LiCoO}_2$          |

> **物理约束说明**：
>
> - **负极（石墨）**：理论上 $\theta_n$ 可达到1.0（对应 $\text{LiC}_6$），但实际充电时为防止锂金属析出，通常限制在0.85以下 [8]
> - **正极（LCO）**：$\theta_p < 0.4$ 会导致结构不稳定和安全问题，因此满充时 $\theta_p$ 不低于0.4；放电时 $\theta_p$ 接近1.0 [9]
> - **NASA数据集验证**：本项目使用的NASA B0005/B0006/B0007/B0018电池为商业18650 LCO/石墨电池，其电压窗口（2.7V-4.2V）与上述化学计量比范围匹配 [2]

**正极（LCO，钴酸锂）OCV函数**：

代码实现采用多项式展开形式（`src/utils.py` → `OCV_p_corrected`）：

$$
U_p(\theta_p) = 4.06279 + 0.0677504 \tanh(-21.8502\theta_p + 12.8268) + \sum_{k=1}^{5} a_k \left[\frac{1}{(1.00167-\theta_p)^{0.379571}} - 1.576\right]^k
$$

其中多项式展开系数 $a_k = [-0.105734, 0.012637, -0.002803, 0.000237, -0.0000072]$，$\theta_p$ 被限制在 $[0.001, 0.998]$ 范围内。

| 系数           | 值                          | 来源                            |
| -------------- | ----------------------------- | ------------------------------- |
| 常数项         | 4.06279 V                     | 经验拟合，LCO电极半电池数据 [5] |
| $\tanh$ 系数 | -21.8502, 12.8268             | 相变区域拟合参数                |
| 多项式底数     | 1.00167, 0.379571, 1.576      | 高嵌锂度区域修正                |
| 多项式系数     | $a_1$~$a_5$，5阶展开        | 拟合精度提升                    |

**负极（石墨 Graphite）OCV函数**（`src/utils.py` → `OCV_n_corrected`）：

$$
U_n(\theta_n) = 0.6379 + 0.5416 e^{-305.5309\theta_n} + 0.044 \tanh\left(-\frac{\theta_n-0.1958}{0.1088}\right) - 0.1978 \tanh\left(\frac{\theta_n-1.0571}{0.0854}\right) - 0.6875 \tanh\left(\frac{\theta_n+0.0617}{0.0529}\right) - 0.0175 \tanh\left(\frac{\theta_n-0.6117}{0.0335}\right)
$$

| 系数               | 物理意义                     | 来源                         |
| ---------------- | ---------------------------- | ---------------------------- |
| 0.6379 V         | 基线电压                     | 石墨对锂金属的参考电位       |
| 多个$\tanh$ 项 | 石墨分阶段相变对应的电压平台 | 经验拟合，石墨半电池数据 [6] |
| 指数项系数 305.5309 | 低嵌锂度区域的陡峭上升       | -                            |

> **函数来源**：OCV函数的系数来自锂电池电化学文献中对半电池（电极 vs 锂金属）实验数据的曲线拟合，属于**已知经验公式**。

#### 3.1.5 端电压计算

电池端电压由正负极电位差和欧姆损耗组成：

$$
V_{\text{cell}} = (U_p + \eta_p) - (U_n + \eta_n) - IR_e
$$

**变量说明**：

| 符号                | 含义         | 单位 | 状态                     | 说明                         |
| ------------------- | ------------ | ---- | ------------------------ | ---------------------------- |
| $V_{\text{cell}}$ | 电池端电压   | V    | **输出量**         | 模型预测的可测量电压         |
| $U_p$             | 正极开路电压 | V    | **计算量**         | 由$U_p(\theta_p)$ 函数得到 |
| $U_n$             | 负极开路电压 | V    | **计算量**         | 由$U_n(\theta_n)$ 函数得到 |
| $\eta_p$          | 正极过电位   | V    | **计算量**         | 由Butler-Volmer方程反解      |
| $\eta_n$          | 负极过电位   | V    | **计算量**         | 由Butler-Volmer方程反解      |
| $I$               | 外电路电流   | A    | **输入量（已知）** | 由实验数据提供               |
| $R_e$             | 欧姆内阻     | Ω   | **测量值（已知）** | 来自阻抗测量 (metadata.csv)  |

> **电压分解**：
>
> - $(U_p - U_n)$：热力学平衡电压（OCV）
> - $(\eta_p - \eta_n)$：动力学极化损失
> - $IR_e$：欧姆极化损失（线性）

**欧姆内阻 $R_e$ 的物理组成**：

- 集流体电阻（铝箔、铜箔）
- 电极材料电子导电电阻
- 电解液离子导电电阻
- 隔膜离子导电电阻
- 接触电阻（极片与集流体、极耳焊接等）

> **说明**：$R_e$ 不作为待辨识参数，而是直接使用 NASA 数据集中提供的阻抗测量值（metadata.csv 中的 `Re` 列）。这是因为：
> 1. 阻抗测量（EIS）可以直接、准确地测量欧姆内阻
> 2. 在 CC 充电段，$R_e$ 与其他参数存在耦合，辨识结果不稳定
> 3. 使用测量值可以减少辨识参数数量，提高其他参数的辨识精度

#### 3.1.6 待辨识参数汇总

本模型共有 **8个待辨识参数**，通过优化算法从实验数据中辨识。欧姆内阻 $R_e$ 使用阻抗测量值，不参与辨识：

| 序号 | 参数         | 符号             | 辨识范围                    | 单位    | 物理意义                 | 初始猜测值            | 辨识结果（Cycle 0 典型值）   |
| ---- | ------------ | ---------------- | --------------------------- | ------- | ------------------------ | --------------------- | ---------------------------- |
| 1    | 正极扩散系数 | $D_p$          | $10^{-15}$ ~ $10^{-12}$ | m²/s   | 正极颗粒内锂离子扩散速率 | $1 \times 10^{-14}$ | $\sim 5 \times 10^{-14}$   |
| 2    | 负极扩散系数 | $D_n$          | $10^{-15}$ ~ $10^{-12}$ | m²/s   | 负极颗粒内锂离子扩散速率 | $3 \times 10^{-14}$ | $\sim 8 \times 10^{-14}$   |
| 3    | 正极反应速率 | $k_p$          | $10^{-13}$ ~ $10^{-9}$  | -       | 正极表面反应动力学常数   | $2 \times 10^{-11}$ | $\sim 3 \times 10^{-11}$   |
| 4    | 负极反应速率 | $k_n$          | $10^{-13}$ ~ $10^{-9}$  | -       | 负极表面反应动力学常数   | $2 \times 10^{-11}$ | $\sim 5 \times 10^{-11}$   |
| 5    | 正极颗粒半径 | $R_p$          | $1$ ~ $20$              | μm     | 正极活性材料等效颗粒半径 | $5$ μm             | $\sim 8$ μm               |
| 6    | 负极颗粒半径 | $R_n$          | $1$ ~ $20$              | μm     | 负极活性材料等效颗粒半径 | $5$ μm             | $\sim 10$ μm              |
| 7    | 正极最大浓度 | $c_{s,\max,p}$ | 30000 ~ 60000               | mol/m³ | LCO完全嵌锂浓度          | 50000                 | $\sim 51000$               |
| 8    | 负极最大浓度 | $c_{s,\max,n}$ | 20000 ~ 50000               | mol/m³ | 石墨完全嵌锂浓度         | 30000                 | $\sim 31000$               |

**欧姆内阻（测量值，不辨识）**：

| 符号    | 含义     | 来源                      | 单位 | 典型范围       |
| ------- | -------- | ------------------------- | ---- | -------------- |
| $R_e$ | 欧姆内阻 | metadata.csv 阻抗测量 `Re` | Ω   | 0.04 ~ 0.08 Ω |

> **参数范围来源**：根据锂离子电池电化学参数的典型文献值设定 [1, 5, 6]

**关于参数辨识结果的说明**：

1. **动态辨识策略**：本项目采用**每10个循环重新辨识一次**的策略，即在 Cycle 0, 10, 20, 30, ... 时刻进行参数辨识。两次辨识之间采用**零阶保持**（使用上一次辨识结果）。

   > **辨识间隔说明**：以B0005为例（共168个放电循环），参数辨识在 Cycle 0, 10, 20, ..., 160 共进行 **17次**。
   >
2. **参数演变趋势**：随着电池老化（循环次数增加），辨识参数会呈现规律性变化：

   - **扩散系数** $D_p$, $D_n$：随老化逐渐降低（锂离子扩散变慢）
   - **反应速率** $k_p$, $k_n$：随老化逐渐降低（电化学反应活性下降）
   - **最大浓度** $c_{s,\max,p}$, $c_{s,\max,n}$：随老化略有下降（活性材料损失）
   - **欧姆内阻** $R_e$：随老化逐渐增大（SEI膜增厚、接触电阻增加）——来自测量值
   
3. **$R_e$ 使用测量值的原因**：
   - NASA Battery Dataset 提供了每次阻抗测量的 $R_e$ 值（见 metadata.csv）
   - 阻抗谱（EIS）测量可以精确分离欧姆内阻，比电压曲线辨识更准确
   - 减少辨识参数数量（从9个减少到8个），提高其他参数的辨识精度

4. **辨识结果可视化**：参数演变趋势图见 `plots/params/` 目录下的图像（图4-5至图4-8）

---

### 3.2 参数辨识方法 (PSO-LBFGS混合优化)

#### 3.2.1 目标函数

参数辨识的目标是寻找一组最优参数 $\boldsymbol{\theta}^*$，使得模型预测电压与实测电压之间的误差最小。

**加权均方根误差 (Weighted RMSE)**：

$$
\min_{\boldsymbol{\theta}} J(\boldsymbol{\theta}) = \sqrt{\frac{\sum_{k=1}^{N} w_k (V_{\text{pred},k} - V_{\text{meas},k})^2}{\sum_{k=1}^{N} w_k}}
$$

**变量说明**：

| 符号                       | 含义                     | 状态                   | 说明                                                                                    |
| -------------------------- | ------------------------ | ---------------------- | --------------------------------------------------------------------------------------- |
| $\boldsymbol{\theta}$    | 参数向量                 | **待辨识**       | $\boldsymbol{\theta} = [D_p, D_n, k_p, k_n, R_p, R_n, c_{\max,p}, c_{\max,n}]^T$（8个参数，$R_f$由EIS测量） |
| $J(\boldsymbol{\theta})$ | 目标函数值               | **计算量**       | 越小表示拟合越好                                                                        |
| $N$                      | 采样点数量               | **已知**         | 由实验数据时间序列长度决定                                                              |
| $V_{\text{pred},k}$      | 第$k$ 个时刻的预测电压 | **计算量**       | 由SPM模型输出                                                                           |
| $V_{\text{meas},k}$      | 第$k$ 个时刻的实测电压 | **已知**         | 由实验数据提供                                                                          |
| $w_k$                    | 权重系数                 | **已知（设定）** | 见下表                                                                                  |

**权重设置策略**：

| 电压范围 | 权重$w_k$ | 说明 |
| -------- | ----------- | ---- |

| 电压范围    | 权重$w_k$ | 说明                                              |
| ----------- | ----------- | ------------------------------------------------- |
| 3.8V ~ 4.1V | 2.0         | 电压平台区／电压平台或相变区，对SOH和参数变化敏感 |
| 其他区域    | 1.0         | 常规权重                                          |

### 加权理由（物理、数学与文献依据）

1) 物理机制

- 对于 LiCoO2（LCO）等正极材料，3.8V~4.1V 区域通常对应固溶体/平台段，电压对 SOC 的瞬时斜率 $\mathrm{d}V/\mathrm{d}SOC$ 较小（电压随SOC平缓变化），但这一区域的电压水平对**容量衰减（可用锂量变化）**与**极化/内阻增大**非常敏感：微小的容量损失或内阻上升会导致平台提前下移或平台电压整体偏移，从而在该区引入明显的模型-测量电压差。

2) 数学/灵敏度角度

- 在参数辨识中，目标函数对参数的敏感性与观测量对参数的偏导数（Jacobian）有关。若在某一电压区间，模型电压对关键参数（如 $c_{s,\max}$、$R_f$、$D$ 等）的一阶灵敏度较大，则该区间对参数估计贡献更高。通过加权可以放大该区间的残差对目标函数的影响，从而提高该区间参数的拟合精度并降低参数识别的不确定性（参见下文的参考文献）。

3) 文献支持（示例）

- Doyle, Fuller, Newman (1993). "Modeling of galvanostatic charge and discharge of the lithium/polymer/insertion cell." Journal of The Electrochemical Society. —— 提出基于电化学模型的电压-状态关系与平台段行为分析。
- Plett, G. (2004). "Extended Kalman filtering for battery management systems..." Journal of Power Sources. —— 讨论了电压曲线各区间对状态/参数估计的影响与权重策略。
- Safari, M., Delacourt, C. (2009). "Multimodal physics-based aging model for life prediction of Li-ion batteries." Journal of The Electrochemical Society. —— 讨论了电压平台对老化/容量变化的灵敏性，并在辨识中重视平台区段。

> 注：上面列出的文献用于说明“为什么平台区重要”，具体权重值（如2.0）通常由经验/交叉验证或灵敏度分析确定，文献中常见做法是对平台区加权以提高辨识的鲁棒性与准确度。

### 实用建议与可复现的检验方法

1. 权重取值建议：将平台区权重设置为 $w_{platform}=1.5\sim3.0$ 范围内进行搜索/交叉验证，默认值使用 2.0 作为起点。
2. 权重敏感性检验（可复现步骤）：

- 方法：在参数辨识流程中对平台区权重做扫描（grid search），记录最终拟合的参数向量与目标函数值。
- 观察量：参数估计值随权重变化的稳定性、验证集（或留出数据）上的电压RMSE、以及估计SOH的相对误差。

3. 数值示例（Python 伪码）—— 扫描权重并绘制性能曲线：

```python
import numpy as np
from your_project.optimization import fit_params_weighted, compute_weighted_rmse

weights = [1.0, 1.5, 2.0, 2.5, 3.0]
results = []
for w in weights:
    # 构造按电压区间分配的权重向量 w_k
    w_k = np.ones_like(V_meas)
    idx = (V_meas >= 3.8) & (V_meas <= 4.1)
    w_k[idx] = w

    theta_hat = fit_params_weighted(V_meas, I, T, w_k)
    rmse_val = compute_weighted_rmse(theta_hat, V_meas, w_k)
    results.append((w, theta_hat, rmse_val))

# 绘图：rmse vs weight 或 参数 vs weight，检查稳定性
```

4. 统计不确定度与置信区间：

- 若需量化参数不确定度，可在每个权重下使用引导法（bootstrap）或基于 Fisher 信息矩阵的局部线性化方法估计参数协方差，观察平台区加权对参数方差的影响。

### 参考文献（用于权重设置与平台区灵敏度讨论）

- Doyle, M., Fuller, T. F., & Newman, J. (1993). Modeling of galvanostatic charge and discharge of the lithium/polymer/insertion cell. Journal of The Electrochemical Society.
- Plett, G. L. (2004). Extended Kalman filtering for battery management systems of LiPB-based HEV battery packs. Part 3: State and parameter estimation. Journal of Power Sources.
- Safari, M., & Delacourt, C. (2009). Multimodal physics-based aging model for life prediction of Li-ion batteries. Journal of The Electrochemical Society.
- He, W., Williard, N., Osterman, M., & Pecht, M. (2011). Prognostics of lithium-ion batteries based on Dempster-Shafer theory and the Bayesian Monte Carlo method. Journal of Power Sources.

上面条目为示例性参考，若需要我可以继续补全每篇文献的 DOI/链接并在文中引用标注（例如 [Doyle1993], [Plett2004] 等）。

#### 3.2.2 混合优化策略

采用两阶段优化策略，结合全局搜索与局部优化：

**阶段1：粒子群优化 (PSO) —— 全局搜索**

PSO模拟鸟群觅食行为，通过群体协作搜索全局最优解。

**速度更新方程**：

$$
v_{i,d}^{t+1} = w \cdot v_{i,d}^{t} + c_1 r_1 (p_{i,d}^{\text{best}} - x_{i,d}^{t}) + c_2 r_2 (g_d^{\text{best}} - x_{i,d}^{t})
$$

**位置更新方程**：

$$
x_{i,d}^{t+1} = x_{i,d}^{t} + v_{i,d}^{t+1}
$$

**PSO变量说明**：

| 符号                    | 含义                          | 值/范围         | 状态                   | 说明               |
| ----------------------- | ----------------------------- | --------------- | ---------------------- | ------------------ |
| $v_{i,d}^{t}$         | 粒子$i$ 在第 $d$ 维的速度 | -               | **状态变量**     | 表示搜索方向和步长 |
| $x_{i,d}^{t}$         | 粒子$i$ 在第 $d$ 维的位置 | 参数可行域内    | **状态变量**     | 对应一组候选参数   |
| $w$                   | 惯性权重                      | 0.4 ~ 0.9       | **已知（动态）** | 控制历史速度的影响 |
| $c_1$                 | 认知加速系数                  | 0.5 ~ 2.5       | **已知（动态）** | 控制个体经验的影响 |
| $c_2$                 | 社会加速系数                  | 0.5 ~ 2.5       | **已知（动态）** | 控制群体经验的影响 |
| $r_1$, $r_2$        | 随机数                        | [0, 1] 均匀分布 | **随机变量**     | 增加搜索随机性     |
| $p_{i}^{\text{best}}$ | 粒子$i$ 的历史最优位置      | -               | **记录量**       | 个体记忆           |
| $g^{\text{best}}$     | 全局历史最优位置              | -               | **记录量**       | 群体共享信息       |
| $t$                   | 迭代次数                      | 1 ~$T_{\max}$ | **计数器**       | -                  |

**自适应参数策略（本项目采用）**：

| 参数    | 更新公式                             | 初始值 | 终止值 | 策略说明                     |
| ------- | ------------------------------------ | ------ | ------ | ---------------------------- |
| $w$   | $w = 0.9 - 0.5 \cdot t/T_{\max}$   | 0.9    | 0.4    | 线性递减，前期探索，后期收敛 |
| $c_1$ | $c_1 = 2.5 - 2.0 \cdot t/T_{\max}$ | 2.5    | 0.5    | 递减，减少个体影响           |
| $c_2$ | $c_2 = 0.5 + 2.0 \cdot t/T_{\max}$ | 0.5    | 2.5    | 递增，增加群体影响           |

**PSO超参数设置**：

| 参数                     | 值 | 说明         |
| ------------------------ | -- | ------------ |
| 粒子数量                 | 30 | 搜索并行度   |
| 最大迭代次数$T_{\max}$ | 30 | 控制计算开销 |

**阶段2：L-BFGS-B 局部优化**

以PSO输出的全局最优解 $g^{\text{best}}$ 为初始点，使用 L-BFGS-B 进行带边界约束的局部精细搜索：

$$
\boldsymbol{\theta}^* = \arg\min_{\boldsymbol{\theta} \in \Omega} J(\boldsymbol{\theta})
$$

| 符号                      | 含义       | 说明                 |
| ------------------------- | ---------- | -------------------- |
| $\Omega$                | 参数可行域 | 由各参数的上下界定义 |
| $\boldsymbol{\theta}^*$ | 最优参数解 | 优化算法输出         |

**L-BFGS-B 设置**：

| 参数          | 值          | 说明             |
| ------------- | ----------- | ---------------- |
| 收敛容差 ftol | $10^{-8}$ | 目标函数变化阈值 |
| 最大迭代次数  | 100         | 确保充分收敛     |

#### 3.2.3 初始SOC估计

模型仿真前需要确定电池的初始状态。采用二分法（Brent方法）求解初始SOC：

$$
\text{SOC}_0 = \text{SOC such that } U_{\text{OCV}}(\text{SOC}) = V_{\text{meas}}(t=0) + I(t=0) \cdot R_f
$$

| 符号                           | 含义              | 状态             | 说明               |
| ------------------------------ | ----------------- | ---------------- | ------------------ |
| $\text{SOC}_0$               | 初始荷电状态      | **计算量** | 通过数值方法求解   |
| $U_{\text{OCV}}(\text{SOC})$ | SOC对应的开路电压 | **计算量** | 由OCV函数得到      |
| $V_{\text{meas}}(t=0)$       | 初始时刻实测电压  | **已知**   | 实验数据首个采样点 |
| $I(t=0)$                     | 初始时刻电流      | **已知**   | 实验数据首个采样点 |

> **原理**：初始时刻电压 = OCV - IR降，反解可得初始SOC

---

### 3.3 特征工程

本项目的核心创新之一是**融合外部可测特征与SPM内部微观特征**，构建更具物理意义的特征向量。

#### 3.3.1 外部可测特征

这些特征可直接从电池充放电实验数据中提取，无需电化学模型：

| 序号 | 特征名称     | 符号                        | 定义                                                  | 单位 | 物理意义               |
| ---- | ------------ | --------------------------- | ----------------------------------------------------- | ---- | ---------------------- |
| 1    | 恒流充电时间 | $t_{\text{rise}}$         | CC阶段持续时间（$I > 1.0$A）                        | s    | 活性锂损失导致充电变慢 |
| 2    | 放电能量     | $E$                       | $E = \int_0^{t_{\text{end}}} V(t) \cdot I(t) \, dt$ | Wh   | 电池实际做功能力下降   |
| 3    | 容量增量峰值 | $\text{IC}_{\text{peak}}$ | $\max\left(\frac{dQ}{dV}\right)$                    | Ah/V | 反映电极相变过程变化   |

**外部特征选择依据**：

这3个外部特征从**不同物理维度**刻画电池老化状态，具有互补性：

| 特征                        | 选择依据             | 与SOH的关联机制                              | 文献支撑 |
| --------------------------- | -------------------- | -------------------------------------------- | -------- |
| $t_{\text{rise}}$         | 反映电池可充入的容量 | 活性锂损失 → 可用容量↓ → 充电时间↓       | [15]     |
| $E$                       | 直接反映电池做功能力 | SOH↓ → 能量输出↓                          | [16]     |
| $\text{IC}_{\text{peak}}$ | 反映电极材料相变过程 | 活性材料损失 → 峰值↓；极化增大 → 峰位偏移 | [17, 18] |

**容量增量分析（IC Analysis）详解**：

容量增量分析（Incremental Capacity Analysis, ICA）是一种广泛用于电池老化诊断的技术 [17]。其核心思想是对充电曲线 $Q$ vs $V$ 进行微分：

$$
\text{IC} = \frac{dQ}{dV}
$$

**物理意义**：

- IC曲线的**峰值**对应电极材料的**相变过程**（如LCO正极的有序-无序相变）
- **峰值高度**反映参与相变的活性材料量 → 活性材料损失导致峰值降低
- **峰值位置**反映电极电位 → 极化增大或锂库存变化导致峰位偏移

**为什么使用IC峰值作为特征**：

- 相比直接使用容量，IC峰值对**早期老化更敏感** [18]
- IC峰值的变化可以区分**不同老化机制**（如活性锂损失 vs 活性材料损失）
- 是一种**非侵入式**的老化诊断方法，仅需充放电数据即可计算

**计算细节**：

| 特征                        | 计算公式                                           | 数据来源     | 说明                 |
| --------------------------- | -------------------------------------------------- | ------------ | -------------------- |
| $t_{\text{rise}}$         | $\sum \Delta t_k$ where $I_k > 1.0$A           | 充电阶段数据 | 仅统计CC恒流阶段时长 |
| $E$                       | $\sum_{k} V_k \cdot I_k \cdot \Delta t_k / 3600$ | 放电阶段数据 | 单位转换：J → Wh    |
| $\text{IC}_{\text{peak}}$ | $\max(\Delta Q / \Delta V)$                      | 充电阶段数据 | 需对电压进行平滑滤波 |

> **变量说明**：
>
> - $Q$：累积充电容量 [Ah]，$Q = \int I \, dt$
> - $\Delta t_k$：第 $k$ 个采样间隔 [s]
> - IC（Incremental Capacity）：容量增量分析法
> - 计算IC时需要对电压进行Savitzky-Golay滤波以减少噪声影响

#### 3.3.2 SPM内部微观特征

这些特征由SPM模型仿真输出，反映电池内部电化学状态：

| 序号 | 特征名称         | 符号                          | 定义                                                   | 单位    | 物理意义           |
| ---- | ---------------- | ----------------------------- | ------------------------------------------------------ | ------- | ------------------ |
| 4    | 正极平均表面浓度 | $\bar{c}_{s,\text{surf},p}$ | $\frac{1}{N}\sum_{k=1}^{N} c_{s,\text{surf},p}(t_k)$ | mol/m³ | 正极材料嵌锂状态   |
| 5    | 正极平均过电位   | $\bar{\eta}_p$              | $\frac{1}{N}\sum_{k=1}^{N} \eta_p(t_k)$              | V       | 正极动力学极化程度 |
| 6    | 负极平均表面浓度 | $\bar{c}_{s,\text{surf},n}$ | $\frac{1}{N}\sum_{k=1}^{N} c_{s,\text{surf},n}(t_k)$ | mol/m³ | 负极材料嵌锂状态   |
| 7    | 负极平均过电位   | $\bar{\eta}_n$              | $\frac{1}{N}\sum_{k=1}^{N} \eta_n(t_k)$              | V       | 负极动力学极化程度 |

> **关于"平均"的说明**：
>
> - **平均范围**：指**单个循环内所有采样点的时间平均值**，不是跨循环的平均
> - **$N$ 的含义**：单个放电循环中的采样点数（通常约 100~200 个采样点，取决于采样率和放电时长）
> - **计算时机**：**每个循环都计算一次**，即每个循环得到一个7维特征向量
> - **与参数辨识的区别**：参数辨识每10个循环进行一次，但特征提取在每个循环都进行。两次参数辨识之间（如 Cycle 1~9），模型使用上一次辨识的参数（Cycle 0 的参数）进行仿真并提取特征（零阶保持）

#### 3.3.3 特征向量构建

每个充放电循环提取 **7维特征向量**：

$$
\mathbf{x}_k = [t_{\text{rise}}, E, \text{IC}_{\text{peak}}, \bar{c}_{s,p}, \bar{\eta}_p, \bar{c}_{s,n}, \bar{\eta}_n]^T \in \mathbb{R}^7
$$

| 索引 | 特征                        | 类型     | 说明             |
| ---- | --------------------------- | -------- | ---------------- |
| 1    | $t_{\text{rise}}$         | 外部特征 | 恒流充电时间     |
| 2    | $E$                       | 外部特征 | 放电能量         |
| 3    | $\text{IC}_{\text{peak}}$ | 外部特征 | IC峰值           |
| 4    | $\bar{c}_{s,p}$           | SPM特征  | 正极表面浓度均值 |
| 5    | $\bar{\eta}_p$            | SPM特征  | 正极过电位均值   |
| 6    | $\bar{c}_{s,n}$           | SPM特征  | 负极表面浓度均值 |
| 7    | $\bar{\eta}_n$            | SPM特征  | 负极过电位均值   |

#### 3.3.4 SPM特征预处理：差分 + Per-Battery Z-Score

**问题**：SPM微观变量的绝对值是辨识参数的非线性函数，不同电池的辨识参数不同，导致微观变量的分布域偏移（domain shift），跨电池泛化能力差。

**解决方案**（对第4~7维SPM特征应用）：

1. **差分**：使用相邻循环间的相对变化率，消除绝对值水平差异

$$
\Delta f_k = \frac{f_k - f_{k-1}}{|f_{k-1}|}
$$

2. **Per-Battery Z-Score**：对每个电池独立标准化，对齐分布

$$
\hat{f}_k = \frac{\Delta f_k - \mu_{\Delta f}}{\sigma_{\Delta f}}
$$

这样不同电池只保留“老化引起的变化趋势”，消除电池特异性的绝对偏差。

#### 3.3.5 特征归一化（MinMax缩放）

为消除量纲影响，将特征归一化到 [0, 1] 区间：

$$
x'_{j} = \frac{x_j - x_{\min,j}}{x_{\max,j} - x_{\min,j}}
$$

| 符号           | 含义                   | 状态             | 说明             |
| -------------- | ---------------------- | ---------------- | ---------------- |
| $x_j$        | 原始特征值             | **计算量** | 第$j$ 个特征   |
| $x'_j$       | 归一化后特征值         | **计算量** | 范围 [0, 1]      |
| $x_{\min,j}$ | 第$j$ 个特征的最小值 | **已知**   | 由训练集统计得到 |
| $x_{\max,j}$ | 第$j$ 个特征的最大值 | **已知**   | 由训练集统计得到 |

> **注意**：归一化参数 $(x_{\min}, x_{\max})$ 仅由训练集计算，测试集使用相同参数进行变换

---

### 3.4 SP-LSTM网络架构

SP-LSTM（Single Particle - Long Short-Term Memory）是本项目设计的融合SPM特征的时序预测网络。

#### 3.4.1 网络结构

```
输入层: (batch_size, seq_len, 7)     ← 7维特征向量序列
    ↓
特征门控: feature_scale (可学习参数)  ← 自适应加权各维特征的重要性
    ↓
双向LSTM层: hidden_size=64, num_layers=2, bidirectional=True
    ↓                                    ← 2层堆叠双向LSTM，Dropout=0.2
取最后时间步: out[:, -1, :]            ← 双向拼接后维度=128
    ↓
BatchNorm1d(128)                       ← 批归一化，提升训练稳定性
    ↓
Dropout(0.2)                           ← 正则化
    ↓
全连接层: 128 → 1                      ← 线性映射
    ↓
输出: SOH预测值                        ← 标量输出
```

**网络超参数（已知，人工设定）**：

| 参数         | 符号                  | 值 | 说明                    |
| ------------ | --------------------- | -- | ----------------------- |
| 输入特征维度 | $d_{\text{in}}$     | 7  | 对应7个特征             |
| 隐藏层维度   | $d_h$               | 64 | LSTM隐藏状态大小        |
| LSTM层数     | $n_{\text{layers}}$ | 2  | 堆叠层数                |
| 输出维度     | $d_{\text{out}}$    | 1  | 预测单个SOH值           |
| 序列长度     | $L$                 | 10 | 使用前10个循环预测下一个 |

#### 3.4.2 LSTM单元方程

LSTM（Long Short-Term Memory，长短期记忆网络）通过门控机制捕获时间序列中的长期依赖关系。

**遗忘门**（控制历史信息的遗忘程度）：

$$
f_t = \sigma(W_f \cdot [h_{t-1}, x_t] + b_f)
$$

**输入门**（控制新信息的写入程度）：

$$
i_t = \sigma(W_i \cdot [h_{t-1}, x_t] + b_i)
$$

**候选细胞状态**（新的候选记忆）：

$$
\tilde{C}_t = \tanh(W_C \cdot [h_{t-1}, x_t] + b_C)
$$

**细胞状态更新**（核心记忆单元）：

$$
C_t = f_t \odot C_{t-1} + i_t \odot \tilde{C}_t
$$

**输出门**（控制输出的信息）：

$$
o_t = \sigma(W_o \cdot [h_{t-1}, x_t] + b_o)
$$

**隐藏状态**（当前时刻输出）：

$$
h_t = o_t \odot \tanh(C_t)
$$

**LSTM变量说明**：

| 符号                   | 含义                     | 维度                                              | 状态                 | 说明                                             |
| ---------------------- | ------------------------ | ------------------------------------------------- | -------------------- | ------------------------------------------------ |
| $x_t$                | 时刻$t$ 的输入向量     | $\mathbb{R}^{d_{\text{in}}}$                    | **输入**       | 归一化后的特征向量                               |
| $h_t$                | 时刻$t$ 的隐藏状态     | $\mathbb{R}^{d_h}$                              | **状态变量**   | 包含历史信息的表示                               |
| $C_t$                | 时刻$t$ 的细胞状态     | $\mathbb{R}^{d_h}$                              | **状态变量**   | 长期记忆单元                                     |
| $f_t$                | 遗忘门激活值             | $\mathbb{R}^{d_h}$                              | **计算量**     | 取值 (0,1)，控制遗忘                             |
| $i_t$                | 输入门激活值             | $\mathbb{R}^{d_h}$                              | **计算量**     | 取值 (0,1)，控制写入                             |
| $o_t$                | 输出门激活值             | $\mathbb{R}^{d_h}$                              | **计算量**     | 取值 (0,1)，控制输出                             |
| $\tilde{C}_t$        | 候选细胞状态             | $\mathbb{R}^{d_h}$                              | **计算量**     | 新的候选记忆                                     |
| $W_f, W_i, W_C, W_o$ | 门权重矩阵               | $\mathbb{R}^{d_h \times (d_h + d_{\text{in}})}$ | **可学习参数** | 通过训练优化                                     |
| $b_f, b_i, b_C, b_o$ | 门偏置向量               | $\mathbb{R}^{d_h}$                              | **可学习参数** | 通过训练优化                                     |
| $\sigma(\cdot)$      | Sigmoid激活函数          | -                                                 | **函数**       | $\sigma(z) = \frac{1}{1+e^{-z}}$               |
| $\tanh(\cdot)$       | 双曲正切函数             | -                                                 | **函数**       | $\tanh(z) = \frac{e^z - e^{-z}}{e^z + e^{-z}}$ |
| $\odot$              | Hadamard积（逐元素乘法） | -                                                 | **运算符**     | 对应位置相乘                                     |
| $[\cdot, \cdot]$     | 向量拼接                 | -                                                 | **运算符**     | 将两个向量首尾相连                               |

#### 3.4.3 序列构建

将连续 $L$ 个循环的特征向量组成时序输入，预测第 $L+1$ 个循环的SOH：

$$
\mathbf{X}_k = [\mathbf{x}_{k}, \mathbf{x}_{k+1}, \ldots, \mathbf{x}_{k+L-1}] \in \mathbb{R}^{L \times 7}
$$

$$
y_k = \text{SOH}_{k+L}
$$

| 符号             | 含义                         | 说明                       |
| ---------------- | ---------------------------- | -------------------------- |
| $\mathbf{X}_k$ | 第$k$ 个训练样本的输入序列 | 包含连续$L$ 个循环的特征 |
| $\mathbf{x}_j$ | 第$j$ 个循环的特征向量     | 7维向量                    |
| $y_k$          | 第$k$ 个样本的标签         | 第$k+L$ 个循环的真实SOH  |
| $L$            | 序列长度（窗口大小）         | 本项目取$L=10$           |

> **滑动窗口方法**：从循环序列中以步长1滑动取样，生成训练样本

#### 3.4.4 损失函数与优化

**均方误差 (MSE) 损失函数**：

$$
\mathcal{L} = \underbrace{\frac{1}{N}\sum_{i=1}^{N}(\hat{y}_i - y_i)^2}_{\text{MSE Loss}} + 0.1 \cdot \underbrace{\frac{1}{N-1}\sum_{i=2}^{N}\left[(\hat{y}_i - \hat{y}_{i-1}) - (y_i - y_{i-1})\right]^2}_{\text{Trend Loss}}
$$

> **趋势损失**（权重0.1）：约束预测序列的相邻差分与真实值的差分一致，确保预测的SOH下降趋势与实际老化趋势吻合。

| 符号            | 含义                    | 状态             | 说明               |
| --------------- | ----------------------- | ---------------- | ------------------ |
| $\mathcal{L}$ | 损失函数值              | **计算量** | 越小表示预测越准   |
| $N$           | 训练样本数量            | **已知**   | 由数据集大小决定   |
| $\hat{y}_i$   | 第$i$ 个样本的预测SOH | **计算量** | 网络输出           |
| $y_i$         | 第$i$ 个样本的真实SOH | **已知**   | 训练标签（见下文） |

**真值 $y_i$（Ground Truth SOH）的计算**：

真实SOH值从NASA实验数据中计算得到，不是模型预测的：

$$
y_i = \text{SOH}_k = \frac{Q_k}{Q_{\text{initial}}} \times 100\%
$$

其中 $Q_{\text{initial}}$ 为该电池首次循环的实测容量，$Q_k$ 由放电电流积分计算：

$$
Q_k = \frac{1}{3600}\sum_{j} (-I_j) \cdot \Delta t_j \quad \text{[Ah]}
$$

对应代码（`data_loader.py`）：

```python
Q_k = self._compute_capacity(t, I)
Q_initial = self.get_initial_capacity(battery_id)
SOH = Q_k / Q_initial  # 相对于首次循环容量
```

| 项目                    | 来源             | 说明                                           |
| ----------------------- | ---------------- | ---------------------------------------------- |
| $y_i$（真值）         | NASA实验数据     | 由放电容量积分计算，除以$Q_{\text{initial}}$ |
| $\hat{y}_i$（预测值） | SP-LSTM模型输出  | 模型学习预测                                   |
| 损失函数                | 两者之差的平方和 | 训练目标是最小化$\mathcal{L}$                |

**优化器配置（已知，人工设定）**：

| 参数             | 值    | 说明                   |
| ---------------- | ----- | ---------------------- |
| 优化器           | Adam  | 自适应学习率优化器 [7] |
| 学习率$\alpha$ | 0.001 | 步长超参数             |
| 权重衰减         | 5e-5  | L2正则化               |
| 训练轮数 epochs  | 800   | 最大训练轮数           |
| 学习率调度       | CosineAnnealingWarmRestarts | T_0=100, T_mult=2, eta_min=1e-6 |
| 早停 (Early Stopping) | patience=200 | 若200轮内损失无改善则提前终止 |
| 梯度裁剪         | max_norm=1.0 | 防止梯度爆炸           |

**Adam优化器更新规则**：

$$
m_t = \beta_1 m_{t-1} + (1-\beta_1) g_t
$$

$$
v_t = \beta_2 v_{t-1} + (1-\beta_2) g_t^2
$$

$$
\theta_{t+1} = \theta_t - \alpha \frac{\hat{m}_t}{\sqrt{\hat{v}_t} + \epsilon}
$$

| 符号         | 含义         | 值          | 状态                     |
| ------------ | ------------ | ----------- | ------------------------ |
| $g_t$      | 梯度         | -           | **计算量**         |
| $m_t$      | 一阶矩估计   | -           | **状态变量**       |
| $v_t$      | 二阶矩估计   | -           | **状态变量**       |
| $\beta_1$  | 一阶矩衰减率 | 0.9         | **已知（默认值）** |
| $\beta_2$  | 二阶矩衰减率 | 0.999       | **已知（默认值）** |
| $\epsilon$ | 数值稳定常数 | $10^{-8}$ | **已知（默认值）** |

#### 3.4.5 初始状态校正

由于训练集（B0005/B0006/B0007）和测试集（B0018）之间存在电池个体差异，SP-LSTM的预测值可能存在系统性偏移。本项目采用**初始状态校正**机制消除该偏差：

$$
\hat{y}_{\text{corrected}} = \hat{y}_{\text{raw}} + \delta_0
$$

$$
\delta_0 = \frac{1}{N_{\text{init}}} \sum_{i=1}^{N_{\text{init}}} (y_i - \hat{y}_{\text{raw},i})
$$

| 符号               | 含义                   | 值      | 说明                     |
| ------------------ | ---------------------- | ------- | ------------------------ |
| $\delta_0$         | 初始状态校正偏移量     | 自动计算 | 使用前$N_{\text{init}}$个样本的均值偏差 |
| $N_{\text{init}}$  | 校准样本数             | 5       | 使用测试集前5个样本 |

> **说明**：该校正策略同样应用于所有对比模型（SVR、Random Forest、Base LSTM），确保公平对比。

---

## 4. 实验设置

### 4.1 数据集

| 电池ID | 用途 | 循环数 | 标称容量 |
| ------ | ---- | ------ | -------- |
| B0005  | 训练 | ~168   | 2.0 Ah   |
| B0006  | 训练 | ~168   | 2.0 Ah   |
| B0007  | 训练 | ~168   | 2.0 Ah   |
| B0018  | 测试 | ~130   | 2.0 Ah   |

### 4.2 工作条件

- 充电策略：1.5A 恒流（CC）充至 4.2V，然后恒压（CV）截止
- 放电策略：2A 恒流放至截止电压 2.7V
- 环境温度：24°C（室温）

### 4.3 模型超参数

| 参数           | 值         |
| -------------- | ---------- |
| LSTM隐藏层大小 | 64         |
| LSTM层数       | 2（双向）  |
| 序列长度       | 10         |
| 训练轮数       | 800（含早停，patience=200） |
| 学习率         | 0.001      |
| 学习率调度     | CosineAnnealingWarmRestarts (T_0=100, T_mult=2) |
| Dropout        | 0.2        |
| 趋势损失权重   | 0.1        |
| 特征门控       | 是（可学习参数） |
| PSO粒子数      | 30         |
| PSO迭代次数    | 30         |
| L-BFGS-B ftol  | 1e-8       |
| L-BFGS-B maxiter | 100      |
| 参数辨识间隔   | 每10个循环 |

---

## 5. 结果分析

### 5.1 灵敏度分析

采用 **Sobol 全局灵敏度分析**量化各参数对模型输出（电压RMSE）的影响：

- **一阶灵敏度指数 $S_1$**：单个参数独立贡献
- **总效应灵敏度指数 $S_T$**：参数独立贡献 + 与其他参数的交互作用

分析结果显示：

- $c_{\max,n}$（负极最大浓度）对电压响应影响最大，其一阶灵敏度和总效应灵敏度均显著高于其他参数
- $R_n$（负极颗粒半径）、$D_n$（负极扩散系数）有一定影响
- 正极参数的影响相对较小
- 注：$R_f$（欧姆内阻）可通过EIS直接测量，不作为待辨识参数，因此不纳入灵敏度分析

### 5.2 参数演变趋势

随着电池老化（循环次数增加）：

- 扩散系数 $D_p$, $D_n$ 呈下降趋势 → 固相扩散性能退化
- 反应速率常数 $k_p$, $k_n$ 呈上升趋势 → SEI层增长增加动力学阻抗

### 5.3 SOH估计精度

| 模型                         |  | 测试集 RMSE    | 测试集 MAE     |
| ---------------------------- | - | -------------- | -------------- |
| SVR                          |  | 较高           | 较高           |
| Random Forest                |  | 中等           | 中等           |
| Base LSTM (仅外部特征)       |  | 中等           | 中等           |
| **SP-LSTM (本文方法)** |  | **最低** | **最低** |

SP-LSTM 通过融合机理模型特征，显著提升了SOH估计精度。

### 5.4 鲁棒性分析

对电压测量信号添加不同水平的高斯噪声（0%, 1%, 2%, 3%），评估方法的抗干扰能力。噪声仅注入电压传感器信号（电流为充放电仪的控制量，精度远高于电压传感器）。噪声注入后重新进行SPM参数辨识和特征提取，评估整个pipeline的端到端鲁棒性。结果表明本方法在合理噪声水平下仍能保持较高的预测精度。

此外，鲁棒性分析地内置了**中值滤波去噪预处理**（窗口大小=5），模拟实际BMS系统中的信号预处理模块。

---

## 6. 文件结构

```
SOH ES/
├── main.py                    # 主程序入口
├── README.md                  # 项目说明文档
├── cleaned_dataset/           # 数据集目录
│   ├── metadata.csv          # 元数据（电池ID、循环类型、容量等）
│   ├── data/                 # 原始充放电CSV文件
│   └── extra_infos/          # 附加信息
├── plots/                     # 可视化结果输出
│   ├── sensitivity/          # 灵敏度分析图
│   ├── features/             # 特征分析图
│   ├── params/               # 参数演变图
│   ├── results_B0018/        # B0018 SOH预测结果图
│   ├── comparison/           # 算法对比图
│   ├── robustness/           # 鲁棒性分析图
│   └── validation/           # 验证结果
└── src/                       # 源代码模块
    ├── __init__.py
    ├── spm_model.py          # 双电极SPM模型实现
    ├── optimization.py       # PSO-LBFGS混合优化器
    ├── features.py           # 特征提取器
    ├── soh_estimator.py      # SP-LSTM网络
    ├── data_loader.py        # 数据加载器
    ├── sensitivity.py        # 灵敏度分析模块
    ├── comparison.py         # 算法对比模块
    ├── robustness.py         # 鲁棒性分析模块
    ├── plotting.py           # 可视化模块
    └── utils.py              # 工具函数（常数、OCV函数等）
```

---

## 7. 使用方法

### 7.1 环境依赖

```bash
pip install numpy scipy pandas matplotlib scikit-learn torch SALib
```

### 7.2 运行完整流程

```bash
python main.py
```

### 7.3 主要流程

1. **阶段0**：灵敏度分析 → 确定关键参数
2. **阶段1**：参数辨识与特征提取 → 遍历所有循环
3. **阶段2**：数据集准备 → 归一化、序列构建
4. **阶段3**：SP-LSTM训练与预测
5. **阶段4**：算法对比（SVR、Random Forest、Base LSTM）
6. **阶段5**：结果可视化
7. **阶段6**：鲁棒性分析

---

## 符号表

### 物理常数（已知固定值）

| 符号  | 含义         | 值       | 单位       | 来源             |
| ----- | ------------ | -------- | ---------- | ---------------- |
| $F$ | 法拉第常数   | 96485.33 | C/mol      | 物理常数         |
| $R$ | 通用气体常数 | 8.314    | J/(mol·K) | 物理常数         |
| $T$ | 实验温度     | 298.15   | K          | 实验条件 (25°C) |

### 已知几何参数（固定值）

| 符号                       | 含义                 | 值                    | 单位    | 来源                |
| -------------------------- | -------------------- | --------------------- | ------- | ------------------- |
| $L_p$                    | 正极涂层厚度         | $70 \times 10^{-6}$ | m       | 18650电池典型值 [1] |
| $L_n$                    | 负极涂层厚度         | $80 \times 10^{-6}$ | m       | 18650电池典型值 [1] |
| $\varepsilon_{s,p}$      | 正极活性物质体积分数 | 0.5                   | -       | 电极设计 [1]        |
| $\varepsilon_{s,n}$      | 负极活性物质体积分数 | 0.6                   | -       | 电极设计 [1]        |
| $A_{\text{geo}}$         | 电极几何面积         | 0.042                 | m²     | 2.0Ah电池计算       |
| $c_e$                    | 电解液锂离子浓度     | 1000                  | mol/m³ | 典型值 [1]          |
| $\alpha_a$, $\alpha_c$ | 传递系数             | 0.5                   | -       | 对称反应假设        |

### 待辨识参数（优化求解）

| 符号             | 含义             | 辨识范围                    | 单位    | 初始值                |
| ---------------- | ---------------- | --------------------------- | ------- | --------------------- |
| $D_p$          | 正极固相扩散系数 | $10^{-15}$ ~ $10^{-12}$ | m²/s   | $1 \times 10^{-14}$ |
| $D_n$          | 负极固相扩散系数 | $10^{-15}$ ~ $10^{-12}$ | m²/s   | $3 \times 10^{-14}$ |
| $k_p$          | 正极反应速率常数 | $10^{-13}$ ~ $10^{-9}$  | -       | $2 \times 10^{-11}$ |
| $k_n$          | 负极反应速率常数 | $10^{-13}$ ~ $10^{-9}$  | -       | $2 \times 10^{-11}$ |
| $R_p$          | 正极颗粒半径     | 1 ~ 20                      | μm     | 5                     |
| $R_n$          | 负极颗粒半径     | 1 ~ 20                      | μm     | 5                     |
| $c_{s,\max,p}$ | 正极最大锂浓度   | 30000 ~ 60000               | mol/m³ | 50000                 |
| $c_{s,\max,n}$ | 负极最大锂浓度   | 20000 ~ 50000               | mol/m³ | 30000                 |

> **注**：$R_f$（欧姆内阻）可通过EIS测量直接获得，不作为待辨识参数。

### 状态变量与计算量

| 符号                    | 含义             | 单位         | 类型     | 说明                                  |
| ----------------------- | ---------------- | ------------ | -------- | ------------------------------------- |
| $c_{s,i}$             | 固相锂离子浓度   | mol/m³      | 状态变量 | 随时间和位置变化                      |
| $\bar{c}_{s,i}$       | 平均固相浓度     | mol/m³      | 状态变量 | 通过质量守恒更新                      |
| $c_{s,\text{surf},i}$ | 表面锂离子浓度   | mol/m³      | 计算量   | 多项式近似                            |
| $\theta_i$            | 化学计量比       | -            | 计算量   | $\theta = c_{\text{surf}}/c_{\max}$ |
| $j_i$                 | 电极表面摩尔通量 | mol/(m²·s) | 计算量   | 由电流计算                            |
| $j_{0,i}$             | 交换电流密度     | mol/(m²·s) | 计算量   | Butler-Volmer方程                     |
| $\eta_i$              | 电极过电位       | V            | 计算量   | 偏离平衡的程度                        |
| $U_p$, $U_n$        | 正/负极开路电压  | V            | 计算量   | OCV函数                               |
| $V_{\text{cell}}$     | 电池端电压       | V            | 输出量   | 模型预测值                            |
| $a_{s,i}$             | 比表面积         | m⁻¹        | 计算量   | $3\varepsilon_s/R$                  |
| $A_{\text{total},i}$  | 总活性面积       | m²          | 计算量   | 几何导出                              |

### 输入量（实验数据提供）

| 符号                | 含义         | 单位 | 来源                                           |
| ------------------- | ------------ | ---- | ---------------------------------------------- |
| $t$               | 时间         | s    | NASA数据集                                     |
| $I$               | 外电路电流   | A    | NASA数据集（放电为负）                         |
| $V_{\text{meas}}$ | 实测端电压   | V    | NASA数据集                                     |
| $Q$               | 放电容量     | Ah   | 由电流积分计算                                 |
| $\text{SOH}$      | 电池健康状态 | -    | $Q_k / Q_{\text{initial}}$，首次循环SOH=100% |

### 特征符号

| 符号                          | 含义                | 单位    | 类型     |
| ----------------------------- | ------------------- | ------- | -------- |
| $t_{\text{rise}}$           | 恒流充电时间        | s       | 外部特征 |
| $E$                         | 放电能量            | Wh      | 外部特征 |
| $\text{IC}_{\text{peak}}$   | 容量增量峰值        | Ah/V    | 外部特征 |
| $\bar{c}_{s,\text{surf},p}$ | 正极平均表面浓度    | mol/m³ | SPM特征  |
| $\bar{c}_{s,\text{surf},n}$ | 负极平均表面浓度    | mol/m³ | SPM特征  |
| $\bar{\eta}_p$              | 正极平均过电位      | V       | SPM特征  |
| $\bar{\eta}_n$              | 负极平均过电位      | V       | SPM特征  |
| $\mathbf{x}_k$              | 第k个循环的特征向量 | -       | 7维向量  |

### 优化算法符号

| 符号                       | 含义             | 值/范围    | 类型     |
| -------------------------- | ---------------- | ---------- | -------- |
| $\boldsymbol{\theta}$    | 待辨识参数向量   | 9维        | 优化变量 |
| $J(\boldsymbol{\theta})$ | 目标函数（RMSE） | ≥0        | 计算量   |
| $w_k$                    | 权重系数         | 1.0 或 2.0 | 设定值   |
| $v_{i,d}^t$              | PSO粒子速度      | -          | 状态变量 |
| $x_{i,d}^t$              | PSO粒子位置      | -          | 状态变量 |
| $w$                      | PSO惯性权重      | 0.4~0.9    | 动态参数 |
| $c_1$, $c_2$           | PSO加速系数      | 0.5~2.5    | 动态参数 |
| $p_i^{\text{best}}$      | 个体历史最优     | -          | 记录量   |
| $g^{\text{best}}$        | 全局历史最优     | -          | 记录量   |

### LSTM网络符号

| 符号                               | 含义        | 维度                          | 类型       |
| ---------------------------------- | ----------- | ----------------------------- | ---------- |
| $x_t$                            | 时刻t的输入 | $\mathbb{R}^7$              | 输入       |
| $h_t$                            | 隐藏状态    | $\mathbb{R}^{64}$           | 状态变量   |
| $C_t$                            | 细胞状态    | $\mathbb{R}^{64}$           | 状态变量   |
| $f_t$, $i_t$, $o_t$          | 门控激活值  | $\mathbb{R}^{64}$           | 计算量     |
| $W_f$, $W_i$, $W_C$, $W_o$ | 权重矩阵    | $\mathbb{R}^{64 \times 71}$ | 可学习参数 |
| $b_f$, $b_i$, $b_C$, $b_o$ | 偏置向量    | $\mathbb{R}^{64}$           | 可学习参数 |
| $\sigma(\cdot)$                  | Sigmoid函数 | -                             | 激活函数   |
| $\mathcal{L}$                    | MSE损失函数 | -                             | 计算量     |
| $\alpha$                         | 学习率      | 0.001                         | 超参数     |
| $L$                              | 序列长度    | 5                             | 超参数     |

---

## 参考文献

[1] Doyle, M., Fuller, T. F., & Newman, J. (1993). Modeling of galvanostatic charge and discharge of the lithium/polymer/insertion cell. *Journal of The Electrochemical Society*, 140(6), 1526-1533. https://doi.org/10.1149/1.2221597

[2] Saha, B., & Goebel, K. (2007). Battery data set. *NASA Ames Prognostics Data Repository*. https://ti.arc.nasa.gov/tech/dash/groups/pcoe/prognostic-data-repository/

[3] Hochreiter, S., & Schmidhuber, J. (1997). Long short-term memory. *Neural Computation*, 9(8), 1735-1780. https://doi.org/10.1162/neco.1997.9.8.1735

[4] CODATA. (2018). CODATA Recommended Values of the Fundamental Physical Constants: 2018. *NIST Standard Reference Database*.

[5] Safari, M., & Delacourt, C. (2011). Modeling of a commercial graphite/LiFePO4 cell. *Journal of The Electrochemical Society*, 158(5), A562-A571. https://doi.org/10.1149/1.3567007

[6] Ecker, M., Tran, T. K. D., Dechent, P., Käbitz, S., Warnecke, A., & Sauer, D. U. (2015). Parameterization of a physico-chemical model of a lithium-ion battery: I. Determination of parameters. *Journal of The Electrochemical Society*, 162(9), A1836-A1848. https://doi.org/10.1149/2.0551509jes

[7] Kingma, D. P., & Ba, J. (2015). Adam: A method for stochastic optimization. *International Conference on Learning Representations (ICLR)*. https://arxiv.org/abs/1412.6980

[8] Ramadass, P., Haran, B., Gomadam, P. M., White, R., & Popov, B. N. (2004). Development of first principles capacity fade model for Li-ion cells. *Journal of The Electrochemical Society*, 151(2), A196-A203. https://doi.org/10.1149/1.1634273

> 提供了石墨负极在满充状态下的化学计量比上限 $\theta_{n,100\%} = 0.85$，以及18650电池容量衰减机理分析

[9] Doyle, M., Newman, J., Gozdz, A. S., Schmutz, C. N., & Tarascon, J. M. (1996). Comparison of modeling predictions with experimental data from plastic lithium ion cells. *Journal of The Electrochemical Society*, 143(6), 1890-1903. https://doi.org/10.1149/1.1836921

> 提供了LCO正极的化学计量比范围，满充时 $\theta_{p,100\%} = 0.4$（对应 $\text{Li}_{0.4}\text{CoO}_2$）

[10] Ning, G., & Popov, B. N. (2004). Cycle life modeling of lithium-ion batteries. *Journal of The Electrochemical Society*, 151(10), A1584-A1591. https://doi.org/10.1149/1.1787631

> 提供了LCO正极在放电终止时的化学计量比上限 $\theta_{p,0\%} = 0.99$，以及循环老化对化学计量比漂移的影响

[11] Smith, K., & Wang, C. Y. (2006). Solid-state diffusion limitations on pulse operation of a lithium ion cell for hybrid electric vehicles. *Journal of Power Sources*, 161(1), 628-639. https://doi.org/10.1016/j.jpowsour.2006.03.050

> 提供了石墨和LCO电极材料的扩散系数范围和OCV函数的经验拟合参数

[12] Plett, G. L. (2004). Extended Kalman filtering for battery management systems of LiPB-based HEV battery packs: Part 3. State and parameter estimation. *Journal of Power Sources*, 134(2), 277-292. https://doi.org/10.1016/j.jpowsour.2004.02.033

> 讨论了电压曲线各区间对状态/参数估计的影响与权重策略

[13] Safari, M., Morcrette, M., Teyssot, A., & Delacourt, C. (2009). Multimodal physics-based aging model for life prediction of Li-ion batteries. *Journal of The Electrochemical Society*, 156(3), A145-A153. https://doi.org/10.1149/1.3043429

> 讨论了电压平台对老化/容量变化的灵敏性，以及参数辨识中的权重策略

[14] He, W., Williard, N., Osterman, M., & Pecht, M. (2011). Prognostics of lithium-ion batteries based on Dempster-Shafer theory and the Bayesian Monte Carlo method. *Journal of Power Sources*, 196(23), 10314-10321. https://doi.org/10.1016/j.jpowsour.2011.08.040

> 验证了平台区权重对SOH估计精度的提升效果

[15] Severson, K. A., Attia, P. M., Jin, N., Perkins, N., Jiang, B., Yang, Z., ... & Braatz, R. D. (2019). Data-driven prediction of battery cycle life before capacity degradation. *Nature Energy*, 4(5), 383-391. https://doi.org/10.1038/s41560-019-0356-8

> 提出了基于充电曲线特征（包括充电时间）预测电池寿命的方法

[16] Berecibar, M., Gandiaga, I., Villarreal, I., Omar, N., Van Mierlo, J., & Van den Bossche, P. (2016). Critical review of state of health estimation methods of Li-ion batteries for real applications. *Renewable and Sustainable Energy Reviews*, 56, 572-587. https://doi.org/10.1016/j.rser.2015.11.042

> 综述了基于能量、容量等特征的SOH估计方法

[17] Dubarry, M., Svoboda, V., Hwu, R., & Liaw, B. Y. (2006). Incremental capacity analysis and close-to-equilibrium OCV measurements to quantify capacity fade in commercial rechargeable lithium batteries. *Electrochemical and Solid-State Letters*, 9(10), A454-A457. https://doi.org/10.1149/1.2221767

> 首次系统性地提出容量增量分析（ICA）方法用于电池老化诊断

[18] Bloom, I., Christophersen, J. P., & Gering, K. L. (2005). Differential voltage analyses of high-power, lithium-ion cells: 2. Applications. *Journal of Power Sources*, 139(1-2), 295-303. https://doi.org/10.1016/j.jpowsour.2004.07.022

> 验证了IC峰值变化与电池老化机制（活性锂损失、活性材料损失）的关联

---

**作者**：SOH Estimation Project Team
**最后更新**：2026年2月
